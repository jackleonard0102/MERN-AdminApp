"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[726],{726:(e,s,a)=>{a.r(s),a.d(s,{default:()=>F});var r=a(5043),t=a(5444),l=a(5546),n=a(5589),i=a(9748),o=a(7490),c=a(2624),d=a(898),u=a(7021),m=a(2019),h=a(9458),p=a(9800),x=a(1645),A=a(4607),j=a(4327),y=a(9456),g=(a(3418),a(2)),f=a(3900);a(2645);var w=a(579);const{Search:k}=t.A,{Content:C}=l.A,{Option:S}=n.A;const F=function(){const e=(0,y.wA)(),s=(0,y.d4)((e=>e.user)),[a,l]=(0,r.useState)([]),[F,b]=(0,r.useState)(s.page),[v,P]=(0,r.useState)(s.total),[I,E]=(0,r.useState)(!1),[T,N]=(0,r.useState)(s.pageSize),[O,U]=(0,r.useState)(null),[q]=i.A.useForm(),[z,D]=(0,r.useState)(!1),[_,M]=(0,r.useState)(!1),[R]=i.A.useForm(),[G,J]=(0,r.useState)(null),L=[{title:"No",dataIndex:"_id",key:"no",width:"70px",render:(e,s,a)=>(0,w.jsxs)(w.Fragment,{children:[(F-1)*T+a+1," ",s.socketId.length>0?(0,w.jsx)(o.A,{status:"success"}):(0,w.jsx)(o.A,{status:"default"})]})},{title:"Profile",dataIndex:"name",key:"name",render:(e,s)=>(0,w.jsx)("div",{className:"flex items-center",children:(0,w.jsxs)("div",{className:"ml-2",children:[(0,w.jsx)("b",{children:s.name}),(0,w.jsx)("br",{}),s.email]})})},{title:"Status",dataIndex:"status",key:"status",align:"center",render:(e,s)=>(0,w.jsx)(c.A,{checked:1===s.status,onChange:()=>Y(s._id,s.status)})},{title:"Permission",dataIndex:"permission",key:"permission",align:"center",render:e=>{switch(e){case 2:return"Office Manager";case 3:return"Office Clerk";case 4:return"Field Clerk";default:return"Unknown"}}},{title:"Action",key:"action",align:"center",render:(e,s)=>(0,w.jsxs)(d.A,{size:"middle",children:[(0,w.jsx)(u.Ay,{type:"primary",size:"small",onClick:()=>K(s),children:"Update"}),(0,w.jsx)(u.Ay,{danger:!0,size:"small",onClick:()=>B(s._id),children:"Delete"})]})}],Q=(0,r.useCallback)((s=>{E(!0),(async e=>{try{return(await(0,f.iq)("users",{...e,excludePermission:1})).data}catch(s){return console.log("[GET users error]",s),{users:[],total:0}}})({page:s||F,limit:T}).then((s=>{E(!1),s.users?(l(s.users.filter((e=>2!==e.status&&1!==e.permission)).map((e=>({...e,key:e._id})))),P(s.total),e((0,g.c)({total:s.total,page:F,pageSize:T}))):console.error("No users found in response:",s)})).catch((e=>{E(!1),console.error("Error fetching users:",e),m.Ay.error("Failed to fetch users")}))}),[e,F,T]);(0,r.useEffect)((()=>{Q()}),[Q,F,T]);const V=()=>{1===F?Q(1):b(1)},Y=async(e,s)=>{const a=1==s?0:1;try{await(async(e,s)=>{try{await(0,f.zi)("users/".concat(e,"/status"),s)}catch(a){throw console.error("[UPDATE user status error]",a.response||a),a}})(e,{status:a}),Q()}catch(r){console.error("Failed to update user status",r),m.Ay.error("Failed to update user status")}},B=e=>{h.A.confirm({title:"Are you sure you want to delete this user?",content:"This action cannot be undone.",okText:"Yes",okType:"danger",cancelText:"No",onOk:()=>H(e)})},H=async e=>{try{await(async e=>{try{await(0,f.Fb)("users/".concat(e))}catch(s){throw console.error("[DELETE user error]",s),s}})(e),Q(),m.Ay.success("User deleted successfully")}catch(s){m.Ay.error("Failed to delete user")}},K=e=>{U(e),q.setFieldsValue({logo:e.logo,name:e.name,email:e.email,permission:e.permission.toString()}),J(e.logo),D(!0)};return(0,w.jsxs)(C,{className:"mx-auto p-2 px-5 my-5",children:[(0,w.jsxs)(p.A,{gutter:[16,16],justify:"end",children:[(0,w.jsx)(x.A,{sm:12,md:8,lg:6,xl:4,children:(0,w.jsx)(k,{placeholder:"Name...",allowClear:!0,onSearch:V})}),(0,w.jsx)(x.A,{sm:12,md:8,lg:6,xl:4,children:(0,w.jsx)(k,{placeholder:"Email...",allowClear:!0,onSearch:V})}),(0,w.jsx)(x.A,{flex:"auto"}),(0,w.jsx)(x.A,{children:(0,w.jsx)(u.Ay,{type:"primary",onClick:()=>M(!0),children:"Add New User"})}),(0,w.jsxs)(x.A,{span:24,children:[(0,w.jsx)(A.A,{loading:I,columns:L,dataSource:a,pagination:!1}),(0,w.jsx)("div",{className:"text-right mt-2",children:(0,w.jsx)(j.A,{showQuickJumper:!0,showSizeChanger:!0,pageSize:T,current:F,total:v,onChange:(e,s)=>{b(e),N(s)}})})]})]}),(0,w.jsx)(h.A,{visible:_,title:"Create New User",okText:"Create",cancelText:"Cancel",onCancel:()=>M(!1),onOk:async()=>{try{const e=await R.validateFields(),s=new FormData;e.logo&&e.logo.file&&s.append("logo",e.logo.file.originFileObj),s.append("name",e.name),s.append("email",e.email),s.append("password",e.password),s.append("permission",parseInt(e.permission,10)),await(async e=>{try{return(await(0,f.xb)("users",e)).data}catch(s){throw console.error("[CREATE user error]",s),s}})(s),M(!1),Q(),m.Ay.success("User created successfully")}catch(e){m.Ay.error("Failed to create user")}},children:(0,w.jsxs)(i.A,{form:R,layout:"vertical",children:[(0,w.jsx)(i.A.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter the name"}],children:(0,w.jsx)(t.A,{})}),(0,w.jsx)(i.A.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Please enter the email"}],children:(0,w.jsx)(t.A,{})}),(0,w.jsx)(i.A.Item,{name:"password",label:"Password",rules:[{required:!0,message:"Please enter the password"}],children:(0,w.jsx)(t.A.Password,{})}),(0,w.jsx)(i.A.Item,{name:"permission",label:"Permission",rules:[{required:!0,message:"Please select a permission"}],children:(0,w.jsxs)(n.A,{placeholder:"Select permission",children:[(0,w.jsx)(S,{value:"2",children:"Office Manager"}),(0,w.jsx)(S,{value:"3",children:"Office Clerk"}),(0,w.jsx)(S,{value:"4",children:"Field Clerk"})]})})]})}),(0,w.jsx)(h.A,{visible:z,title:"Update User",okText:"Update",cancelText:"Cancel",onCancel:()=>D(!1),onOk:async()=>{try{const e=await q.validateFields(),s=new FormData;e.logo&&e.logo.file&&s.append("logo",e.logo.file.originFileObj),s.append("name",e.name),s.append("email",e.email),s.append("permission",parseInt(e.permission,10)),await(async(e,s)=>{try{return(await(0,f.eR)("users/".concat(e),s)).data}catch(a){throw console.error("[UPDATE user details error]",a),a}})(O._id,s),D(!1),Q(),m.Ay.success("User updated successfully")}catch(e){m.Ay.error("Failed to update user")}},children:(0,w.jsxs)(i.A,{form:q,layout:"vertical",children:[(0,w.jsx)(i.A.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter the name"}],children:(0,w.jsx)(t.A,{})}),(0,w.jsx)(i.A.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Please enter the email"}],children:(0,w.jsx)(t.A,{})}),(0,w.jsx)(i.A.Item,{name:"permission",label:"Permission",rules:[{required:!0,message:"Please select a permission"}],children:(0,w.jsxs)(n.A,{placeholder:"Select permission",children:[(0,w.jsx)(S,{value:"2",children:"Office Manager"}),(0,w.jsx)(S,{value:"3",children:"Office Clerk"}),(0,w.jsx)(S,{value:"4",children:"Field Clerk"})]})})]})})]})}}}]);
//# sourceMappingURL=726.5aeecf3b.chunk.js.map